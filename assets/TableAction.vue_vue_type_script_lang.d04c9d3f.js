var nt=Object.defineProperty,ot=Object.defineProperties;var at=Object.getOwnPropertyDescriptors;var ye=Object.getOwnPropertySymbols;var st=Object.prototype.hasOwnProperty,it=Object.prototype.propertyIsEnumerable;var ke=(e,t,n)=>t in e?nt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,w=(e,t)=>{for(var n in t||(t={}))st.call(t,n)&&ke(e,n,t[n]);if(ye)for(var n of ye(t))it.call(t,n)&&ke(e,n,t[n]);return e},I=(e,t)=>ot(e,at(t));var B=(e,t,n)=>new Promise((o,a)=>{var r=s=>{try{u(n.next(s))}catch(i){a(i)}},f=s=>{try{u(n.throw(s))}catch(i){a(i)}},u=s=>s.done?o(s.value):Promise.resolve(s.value).then(r,f);u((n=n.apply(e,t)).next())});import{$ as be,a0 as lt,a1 as ct,a2 as ut,a3 as rt,a4 as dt,a5 as ft,a6 as mt,a7 as gt,a8 as Pe,a9 as ht,aa as pt,ab as vt,ac as Ct,ad as _t,ae as wt,af as yt,ag as kt,ah as $e,ai as Ae,d as G,o as W,c as Q,a as A,aj as bt,ak as St,al as Dt,r as L,b as Ve,z as F,am as fe,an as ae,ao as Ie,ap as X,h as c,n as Be,J as q,B as He,w as x,i as D,j as re,aq as Se,N as we,ar as Me,l as Nt,G as Ot,Q as Ue,T as Ft,as as Tt,at as qe,au as me,_ as xt,av as Et,D as Lt,S as Rt,aw as zt,ax as Pt,A as K,ay as $t,az as ce,aA as V,aB as Ce,aC as te,aD as J,aE as De,aF as Ke,aG as At,C as Ne,I as Oe,t as Vt,K as Fe,O as It,aH as We,aI as Ye,V as Bt}from"./index.c29f8fdc.js";import{D as Ht}from"./vuedraggable.umd.3bf75b7e.js";import{u as Mt}from"./useDesignSetting.80d88bfc.js";import{p as _e,s as Ut,Q as qt}from"./propTypes.95cbbb3e.js";import{F as Ge}from"./FormOutlined.b2d87de2.js";import{C as Kt,a as Wt,R as Yt}from"./ReloadOutlined.df9e1cea.js";import{c as Gt}from"./componentSetting.152e7e8a.js";import{u as Zt,t as jt,a as Qt}from"./index.dae2d05a.js";import{D as Jt}from"./DownOutlined.e74f1d9c.js";var Te=be?be.isConcatSpreadable:void 0;function Xt(e){return lt(e)||ct(e)||!!(Te&&e&&e[Te])}function Ze(e,t,n,o,a){var r=-1,f=e.length;for(n||(n=Xt),a||(a=[]);++r<f;){var u=e[r];t>0&&n(u)?t>1?Ze(u,t-1,n,o,a):ut(a,u):o||(a[a.length]=u)}return a}function en(e){var t=e==null?0:e.length;return t?Ze(e,1):[]}function tn(e){return rt(dt(e,void 0,en),e+"")}function nn(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function on(e,t){return t.length<2?e:ft(e,mt(t,0,-1))}function an(e,t){return gt(e,t)}function sn(e,t){return t=Pe(t,e),e=on(e,t),e==null||delete e[ht(nn(t))]}function ln(e){return pt(e)?void 0:e}var cn=1,un=2,rn=4,dn=tn(function(e,t){var n={};if(e==null)return n;var o=!1;t=vt(t,function(r){return r=Pe(r,e),o||(o=r.length>1),r}),Ct(e,_t(e),n),o&&(n=wt(n,cn|un|rn,ln));for(var a=t.length;a--;)sn(n,t[a]);return n});const fn=dn;function xe(e,t){var n;yt(1,arguments);var o=kt((n=t==null?void 0:t.additionalDigits)!==null&&n!==void 0?n:2);if(o!==2&&o!==1&&o!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(!(typeof e=="string"||Object.prototype.toString.call(e)==="[object String]"))return new Date(NaN);var a=pn(e),r;if(a.date){var f=vn(a.date,o);r=Cn(f.restDateString,f.year)}if(!r||isNaN(r.getTime()))return new Date(NaN);var u=r.getTime(),s=0,i;if(a.time&&(s=_n(a.time),isNaN(s)))return new Date(NaN);if(a.timezone){if(i=wn(a.timezone),isNaN(i))return new Date(NaN)}else{var y=new Date(u+s),T=new Date(0);return T.setFullYear(y.getUTCFullYear(),y.getUTCMonth(),y.getUTCDate()),T.setHours(y.getUTCHours(),y.getUTCMinutes(),y.getUTCSeconds(),y.getUTCMilliseconds()),T}return new Date(u+s+i)}var ue={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},mn=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,gn=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,hn=/^([+-])(\d{2})(?::?(\d{2}))?$/;function pn(e){var t={},n=e.split(ue.dateTimeDelimiter),o;if(n.length>2)return t;if(/:/.test(n[0])?o=n[0]:(t.date=n[0],o=n[1],ue.timeZoneDelimiter.test(t.date)&&(t.date=e.split(ue.timeZoneDelimiter)[0],o=e.substr(t.date.length,e.length))),o){var a=ue.timezone.exec(o);a?(t.time=o.replace(a[1],""),t.timezone=a[1]):t.time=o}return t}function vn(e,t){var n=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),o=e.match(n);if(!o)return{year:NaN,restDateString:""};var a=o[1]?parseInt(o[1]):null,r=o[2]?parseInt(o[2]):null;return{year:r===null?a:r*100,restDateString:e.slice((o[1]||o[2]).length)}}function Cn(e,t){if(t===null)return new Date(NaN);var n=e.match(mn);if(!n)return new Date(NaN);var o=!!n[4],a=ne(n[1]),r=ne(n[2])-1,f=ne(n[3]),u=ne(n[4]),s=ne(n[5])-1;if(o)return Dn(t,u,s)?yn(t,u,s):new Date(NaN);var i=new Date(0);return!bn(t,r,f)||!Sn(t,a)?new Date(NaN):(i.setUTCFullYear(t,r,Math.max(a,f)),i)}function ne(e){return e?parseInt(e):1}function _n(e){var t=e.match(gn);if(!t)return NaN;var n=ve(t[1]),o=ve(t[2]),a=ve(t[3]);return Nn(n,o,a)?n*$e+o*Ae+a*1e3:NaN}function ve(e){return e&&parseFloat(e.replace(",","."))||0}function wn(e){if(e==="Z")return 0;var t=e.match(hn);if(!t)return 0;var n=t[1]==="+"?-1:1,o=parseInt(t[2]),a=t[3]&&parseInt(t[3])||0;return On(o,a)?n*(o*$e+a*Ae):NaN}function yn(e,t,n){var o=new Date(0);o.setUTCFullYear(e,0,4);var a=o.getUTCDay()||7,r=(t-1)*7+n+1-a;return o.setUTCDate(o.getUTCDate()+r),o}var kn=[31,null,31,30,31,30,31,31,30,31,30,31];function je(e){return e%400===0||e%4===0&&e%100!==0}function bn(e,t,n){return t>=0&&t<=11&&n>=1&&n<=(kn[t]||(je(e)?29:28))}function Sn(e,t){return t>=1&&t<=(je(e)?366:365)}function Dn(e,t,n){return t>=1&&t<=53&&n>=0&&n<=6}function Nn(e,t,n){return e===24?t===0&&n===0:n>=0&&n<60&&t>=0&&t<60&&e>=0&&e<25}function On(e,t){return t>=0&&t<=59}const Fn={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},Tn=A("path",{d:"M840 836H184c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h656c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zm0-724H184c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h656c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zM610.8 378c6 0 9.4-7 5.7-11.7L515.7 238.7a7.14 7.14 0 0 0-11.3 0L403.6 366.3a7.23 7.23 0 0 0 5.7 11.7H476v268h-62.8c-6 0-9.4 7-5.7 11.7l100.8 127.5c2.9 3.7 8.5 3.7 11.3 0l100.8-127.5c3.7-4.7.4-11.7-5.7-11.7H548V378h62.8z",fill:"currentColor"},null,-1),xn=[Tn],En=G({name:"ColumnHeightOutlined",render:function(t,n){return W(),Q("svg",Fn,xn)}}),Ln={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},Rn=A("path",{d:"M909.3 506.3L781.7 405.6a7.23 7.23 0 0 0-11.7 5.7V476H548V254h64.8c6 0 9.4-7 5.7-11.7L517.7 114.7a7.14 7.14 0 0 0-11.3 0L405.6 242.3a7.23 7.23 0 0 0 5.7 11.7H476v222H254v-64.8c0-6-7-9.4-11.7-5.7L114.7 506.3a7.14 7.14 0 0 0 0 11.3l127.5 100.8c4.7 3.7 11.7.4 11.7-5.7V548h222v222h-64.8c-6 0-9.4 7-5.7 11.7l100.8 127.5c2.9 3.7 8.5 3.7 11.3 0l100.8-127.5c3.7-4.7.4-11.7-5.7-11.7H548V548h222v64.8c0 6 7 9.4 11.7 5.7l127.5-100.8a7.3 7.3 0 0 0 .1-11.4z",fill:"currentColor"},null,-1),zn=[Rn],Pn=G({name:"DragOutlined",render:function(t,n){return W(),Q("svg",Ln,zn)}}),$n={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},An=A("path",{d:"M762 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm-508 0v72.4c0 9.5 4.2 18.4 11.4 24.5L564.6 512L265.4 763.1c-7.2 6.1-11.4 15-11.4 24.5V860c0 6.8 7.9 10.5 13.1 6.1L689 512L267.1 157.9A7.95 7.95 0 0 0 254 164z",fill:"currentColor"},null,-1),Vn=[An],In=G({name:"VerticalLeftOutlined",render:function(t,n){return W(),Q("svg",$n,Vn)}}),Bn={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},Hn=A("path",{d:"M326 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm444 72.4V164c0-6.8-7.9-10.5-13.1-6.1L335 512l421.9 354.1c5.2 4.4 13.1.7 13.1-6.1v-72.4c0-9.4-4.2-18.4-11.4-24.5L459.4 512l299.2-251.1c7.2-6.1 11.4-15.1 11.4-24.5z",fill:"currentColor"},null,-1),Mn=[Hn],Un=G({name:"VerticalRightOutlined",render:function(t,n){return W(),Q("svg",Bn,Mn)}}),Qe=Symbol("s-table");function qn(e){bt(Qe,e)}function Je(){return St(Qe)}const Kn=G({name:"ColumnSetting",components:{SettingOutlined:Dt,DragOutlined:Pn,Draggable:Ht,VerticalRightOutlined:Un,VerticalLeftOutlined:In},setup(){const{getDarkTheme:e}=Mt(),t=Je(),n=L([]),o=L([]),a=Ve({selection:!1,checkAll:!0,checkList:[],defaultCheckList:[]}),r=F(()=>a.selection);fe(()=>{t.getColumns().length&&f()});function f(){const m=i(),h=m.map(C=>C.key);a.checkList=h,a.defaultCheckList=h;const k=m.filter(C=>C.key!="action"&&C.title!="\u64CD\u4F5C");n.value.length||(n.value=ae(k),o.value=ae(k))}function u(m){a.selection&&m.unshift("selection"),s(m)}function s(m){t.setColumns(m)}function i(){let m=[];return t.getColumns().forEach(h=>{m.push(w({},h))}),m}function y(){a.checkList=[...a.defaultCheckList],a.checkAll=!0;let h=t.getCacheColumns().map(k=>I(w({},k),{fixed:void 0}));s(h),n.value=h}function T(m){let h=t.getCacheColumns(!0);m?(s(h),a.checkList=h):(s([]),a.checkList=[])}function R(){const m=X(c(n));n.value=m,s(m)}function d(m){let h=t.getCacheColumns();m?(h.unshift({type:"selection",key:"selection"}),s(h)):(h.splice(0,1),s(h))}function g(m){return m.draggedContext.element.draggable!==!1}function v(m,h){if(!a.checkList.includes(m.key))return;let k=i();const C=m.fixed===h?void 0:h;let $=k.findIndex(H=>H.key===m.key);$!==-1&&(k[$].fixed=C),t.setCacheColumnsField(m.key,{fixed:C}),n.value[$].fixed=C,s(k)}return I(w({},Ie(a)),{columnsList:n,getDarkTheme:e,onChange:u,onCheckAll:T,onSelection:d,onMove:g,resetColumns:y,fixedColumn:v,draggableEnd:R,getSelection:r})}});const Wn={class:"cursor-pointer table-toolbar-right-icon"},Yn={class:"table-toolbar-inner-popover-title"},Gn={class:"table-toolbar-inner"},Zn={class:"fixed-item"},jn=A("span",null,"\u56FA\u5B9A\u5230\u5DE6\u4FA7",-1),Qn=A("span",null,"\u56FA\u5B9A\u5230\u53F3\u4FA7",-1),Jn=A("span",null,"\u5217\u8BBE\u7F6E",-1);function Xn(e,t,n,o,a,r){const f=q("SettingOutlined"),u=we,s=Me,i=Nt,y=Ot,T=q("DragOutlined"),R=q("VerticalRightOutlined"),d=Ue,g=Ft,v=q("VerticalLeftOutlined"),m=q("Draggable"),h=Tt,k=qe;return W(),He(d,{trigger:"hover"},{trigger:x(()=>[A("div",Wn,[D(k,{trigger:"click",width:230,class:"toolbar-popover",placement:"bottom-end"},{trigger:x(()=>[D(u,{size:"18"},{default:x(()=>[D(f)]),_:1})]),header:x(()=>[A("div",Yn,[D(y,null,{default:x(()=>[D(s,{checked:e.checkAll,"onUpdate:checked":[t[0]||(t[0]=C=>e.checkAll=C),e.onCheckAll]},{default:x(()=>[re("\u5217\u5C55\u793A")]),_:1},8,["checked","onUpdate:checked"]),D(s,{checked:e.selection,"onUpdate:checked":[t[1]||(t[1]=C=>e.selection=C),e.onSelection]},{default:x(()=>[re("\u52FE\u9009\u5217")]),_:1},8,["checked","onUpdate:checked"]),D(i,{text:"",type:"info",size:"small",class:"mt-1",onClick:e.resetColumns},{default:x(()=>[re("\u91CD\u7F6E")]),_:1},8,["onClick"])]),_:1})])]),default:x(()=>[A("div",Gn,[D(h,{value:e.checkList,"onUpdate:value":[t[3]||(t[3]=C=>e.checkList=C),e.onChange]},{default:x(()=>[D(m,{modelValue:e.columnsList,"onUpdate:modelValue":t[2]||(t[2]=C=>e.columnsList=C),animation:"300","item-key":"key",filter:".no-draggable",move:e.onMove,onEnd:e.draggableEnd},{item:x(({element:C})=>[A("div",{class:Se(["table-toolbar-inner-checkbox",{"table-toolbar-inner-checkbox-dark":e.getDarkTheme===!0,"no-draggable":C.draggable===!1}])},[A("span",{class:Se(["drag-icon",{"drag-icon-hidden":C.draggable===!1}])},[D(u,{size:"18"},{default:x(()=>[D(T)]),_:1})],2),D(s,{value:C.key,label:C.title},null,8,["value","label"]),A("div",Zn,[D(d,{trigger:"hover",placement:"bottom"},{trigger:x(()=>[D(u,{size:"18",color:C.fixed==="left"?"#2080f0":void 0,class:"cursor-pointer",onClick:$=>e.fixedColumn(C,"left")},{default:x(()=>[D(R)]),_:2},1032,["color","onClick"])]),default:x(()=>[jn]),_:2},1024),D(g,{vertical:""}),D(d,{trigger:"hover",placement:"bottom"},{trigger:x(()=>[D(u,{size:"18",color:C.fixed==="right"?"#2080f0":void 0,class:"cursor-pointer",onClick:$=>e.fixedColumn(C,"right")},{default:x(()=>[D(v)]),_:2},1032,["color","onClick"])]),default:x(()=>[Qn]),_:2},1024)])],2)]),_:1},8,["modelValue","move","onEnd"])]),_:1},8,["value","onUpdate:value"])])]),_:1})])]),default:x(()=>[Jn]),_:1})}const eo=Be(Kn,[["render",Xn]]);function to(e){const t=L(c(e).loading);me(()=>c(e).loading,a=>{t.value=a});const n=F(()=>c(t));function o(a){t.value=a}return{getLoading:n,setLoading:o}}var Xe=(e=>(e.NInput="on-input",e.NInputNumber="on-input",e.NSelect="on-update:value",e.NSwitch="on-update:value",e.NCheckbox="on-update:value",e.NDatePicker="on-update:value",e.NTimePicker="on-update:value",e))(Xe||{});const Z=new Map;Z.set("NInput",xt);Z.set("NInputNumber",Et);Z.set("NSelect",Lt);Z.set("NSwitch",Rt);Z.set("NCheckbox",Me);Z.set("NDatePicker",zt);Z.set("NTimePicker",Pt);const no=({component:e="NInput",rule:t=!0,ruleMessage:n,popoverVisible:o},{attrs:a})=>{const r=Z.get(e),f=K(r,a);return t?K(qe,{"display-directive":"show",show:!!o,manual:"manual"},{trigger:()=>f,default:()=>K("span",{style:{color:"red",width:"90px",display:"inline-block"}},{default:()=>n})}):f};function oo(e){return!e||!e.getBoundingClientRect?0:e.getBoundingClientRect()}function ao(e){const t=document.documentElement,n=t.scrollLeft,o=t.scrollTop,a=t.clientLeft,r=t.clientTop,f=window.pageXOffset,u=window.pageYOffset,s=oo(e),{left:i,top:y,width:T,height:R}=s,d=(f||n)-(a||0),g=(u||o)-(r||0),v=i+f,m=y+u,h=v-d,k=m-g,C=window.document.documentElement.clientWidth,$=window.document.documentElement.clientHeight;return{left:h,top:k,right:C-T-h,bottom:$-R-k,rightIncludeBody:C-h,bottomIncludeBody:$-k}}function Ee(e,t,n){e&&t&&n&&e.addEventListener(t,n,!1)}const de=new Map;let Le;$t||(Ee(document,"mousedown",e=>Le=e),Ee(document,"mouseup",e=>{for(const{documentHandler:t}of de.values())t(e,Le)}));function Re(e,t){let n=[];return Array.isArray(t.arg)?n=t.arg:n.push(t.arg),function(o,a){const r=t.instance.popperRef,f=o.target,u=a.target,s=!t||!t.instance,i=!f||!u,y=e.contains(f)||e.contains(u),T=e===f,R=n.length&&n.some(g=>g==null?void 0:g.contains(f))||n.length&&n.includes(u),d=r&&(r.contains(f)||r.contains(u));s||i||y||T||R||d||t.value()}}const so={beforeMount(e,t){de.set(e,{documentHandler:Re(e,t),bindingFn:t.value})},updated(e,t){de.set(e,{documentHandler:Re(e,t),bindingFn:t.value})},unmounted(e){de.delete(e)}};function ze(e){return e==="NInput"?"\u8BF7\u8F93\u5165":["NPicker","NSelect","NCheckbox","NRadio","NSwitch","NDatePicker","NTimePicker"].includes(e)?"\u8BF7\u9009\u62E9":""}const io=G({name:"EditableCell",components:{FormOutlined:Ge,CloseOutlined:Kt,CheckOutlined:Wt,CellComponent:no},directives:{clickOutside:so},props:{value:{type:[String,Number,Boolean,Object],default:""},record:{type:Object},column:{type:Object,default:()=>({})},index:_e.number},setup(e){const t=Je(),n=L(!1),o=L(),a=L(!1),r=L(""),f=L([]),u=L(e.value),s=L(e.value),i=F(()=>{var l;return((l=e.column)==null?void 0:l.editComponent)||"NInput"}),y=F(()=>{var l;return(l=e.column)==null?void 0:l.editRule}),T=F(()=>c(r)&&c(a)),R=F(()=>{const l=c(i);return["NCheckbox","NRadio"].includes(l)}),d=F(()=>{var S,U,se,ie;const l=(U=(S=e.column)==null?void 0:S.editComponentProps)!=null?U:{},p=(ie=(se=e.column)==null?void 0:se.editComponent)!=null?ie:null,_=c(i),O={},b=c(R);let z=b?"checked":"value";const N=c(u);let E=b?ce(N)&&V(N)?N:!!N:N;_==="NDatePicker"&&(Ce(E)?l.valueFormat?z="formatted-value":E=xe(E).getTime():te(E)&&(l.valueFormat?z="formatted-value":E=E.map(ge=>xe(ge).getTime())));const P=p?Xe[p]:void 0;return I(w(w({placeholder:ze(c(i))},O),fn(l,"onChange")),{[P]:k,[z]:E})}),g=F(()=>{var N,E;const{editComponentProps:l,editValueMap:p}=e.column,_=c(u);if(p&&J(p))return p(_);if(!c(i).includes("NSelect"))return _;const z=((N=l==null?void 0:l.options)!=null?N:c(f)||[]).find(P=>`${P.value}`==`${_}`);return(E=z==null?void 0:z.label)!=null?E:_}),v=F(()=>{const{align:l="center"}=e.column;return`edit-cell-align-${l}`}),m=F(()=>{const{editable:l}=e.record||{};return!!l});fe(()=>{s.value=e.value}),fe(()=>{const{editable:l}=e.column;(V(l)||V(c(m)))&&(n.value=!!l||c(m))});function h(){var l;c(m)||c((l=e.column)==null?void 0:l.editRow)||(r.value="",n.value=!0,Ke(()=>{var _;const p=c(o);(_=p==null?void 0:p.focus)==null||_.call(p)}))}function k(p){return B(this,arguments,function*(l){var z,N,E,P,S;const _=c(i),O=(N=(z=e.column)==null?void 0:z.editComponentProps)!=null?N:{};l?(l==null?void 0:l.target)&&Reflect.has(l.target,"value")?u.value=l.target.value:_==="NCheckbox"?u.value=l.target.checked:(Ce(l)||V(l)||ce(l))&&(u.value=l):u.value=l,_==="NDatePicker"&&(ce(u.value)?O.valueFormat&&(u.value=De(u.value,O.valueFormat)):te(u.value)&&O.valueFormat&&(u.value=u.value.map(U=>{De(U,O.valueFormat)})));const b=(P=(E=e.column)==null?void 0:E.editComponentProps)==null?void 0:P.onChange;b&&J(b)&&b(...arguments),(S=t.emit)==null||S.call(t,"edit-change",{column:e.column,value:c(u),record:X(e.record)}),yield C()})}function C(){return B(this,null,function*(){const{column:l,record:p}=e,{editRule:_}=l,O=c(u);if(_){if(V(_)&&!O&&!ce(O)){a.value=!0;const b=c(i);return r.value=ze(b),!1}if(J(_)){const b=yield _(O,p);return b?(r.value=b,a.value=!0,!1):(r.value="",!0)}}return r.value="",!0})}function $(l=!0,p=!0){return B(this,null,function*(){var P;if(p&&!(yield C()))return!1;const{column:_,index:O,record:b}=e;if(!b)return!1;const{key:z}=_,N=c(u);if(!z)return;Ut(b,z,N),l&&((P=t.emit)==null||P.call(t,"edit-end",{record:b,index:O,key:z,value:N})),n.value=!1})}function H(){return B(this,null,function*(){var l;(l=e.column)!=null&&l.editRow||(yield $())})}function j(){var b;n.value=!1,u.value=s.value;const{column:l,index:p,record:_}=e,{key:O}=l;a.value=!0,r.value="",(b=t.emit)==null||b.call(t,"edit-cancel",{record:_,index:p,key:O,value:c(u)})}function M(){var p;if(((p=e.column)==null?void 0:p.editable)||c(m))return;c(i).includes("NInput")&&j()}function ee(l){f.value=l}function Y(l,p){var _;e.record&&(te(e.record[l])?(_=e.record[l])==null||_.push(p):e.record[l]=[p])}return e.record&&(Y("submitCbs",$),Y("validCbs",C),Y("cancelCbs",j),e.column.key&&(e.record.editValueRefs||(e.record.editValueRefs={}),e.record.editValueRefs[e.column.key]=u),e.record.onCancelEdit=()=>{var l,p;te((l=e.record)==null?void 0:l.cancelCbs)&&((p=e.record)==null||p.cancelCbs.forEach(_=>_()))},e.record.onSubmitEdit=()=>B(this,null,function*(){var l,p,_,O;if(te((l=e.record)==null?void 0:l.submitCbs)){const b=(((p=e.record)==null?void 0:p.validCbs)||[]).map(P=>P());return(yield Promise.all(b)).every(P=>!!P)?((((_=e.record)==null?void 0:_.submitCbs)||[]).forEach(P=>P(!1,!1)),(O=t.emit)==null||O.call(t,"edit-row-end"),!0):void 0}})),{isEdit:n,handleEdit:h,currentValueRef:u,handleSubmit:$,handleChange:k,handleCancel:j,elRef:o,getComponent:i,getRule:y,onClickOutside:M,ruleMessage:r,getRuleVisible:T,getComponentProps:d,handleOptionsChange:ee,getWrapperClass:v,getRowEditable:m,getValues:g,handleEnter:H}}});const lo={class:"editable-cell"},co={class:"flex editable-cell-content"},uo={class:"editable-cell-content-comp"},ro={key:0,class:"editable-cell-action"};function fo(e,t,n,o,a,r){const f=q("FormOutlined"),u=we,s=q("CellComponent"),i=q("CheckOutlined"),y=q("CloseOutlined"),T=At("click-outside");return W(),Q("div",lo,[Ne(A("div",{class:"editable-cell-content",onClick:t[0]||(t[0]=(...R)=>e.handleEdit&&e.handleEdit(...R))},[re(Vt(e.getValues)+" ",1),e.column.editRow?Fe("",!0):(W(),He(u,{key:0,class:"edit-icon"},{default:x(()=>[D(f)]),_:1}))],512),[[Oe,!e.isEdit]]),Ne((W(),Q("div",co,[A("div",uo,[D(s,It(e.getComponentProps,{component:e.getComponent,popoverVisible:e.getRuleVisible,ruleMessage:e.ruleMessage,rule:e.getRule,class:e.getWrapperClass,ref:"elRef",onOptionsChange:e.handleOptionsChange,onPressEnter:e.handleEnter}),null,16,["component","popoverVisible","ruleMessage","rule","class","onOptionsChange","onPressEnter"])]),e.getRowEditable?Fe("",!0):(W(),Q("div",ro,[D(u,{class:"mx-2 cursor-pointer"},{default:x(()=>[D(i,{onClick:e.handleSubmit},null,8,["onClick"])]),_:1}),D(u,{class:"mx-2 cursor-pointer"},{default:x(()=>[D(y,{onClick:e.handleCancel},null,8,["onClick"])]),_:1})]))])),[[Oe,e.isEdit],[T,e.onClickOutside]])])}const mo=Be(io,[["render",fo]]);function go(e){return(t,n)=>{const o=e.key,a=t[o];return t.onEdit=(r,f=!1)=>B(this,null,function*(){var u,s;return f||(t.editable=r),!r&&f?(yield(u=t.onSubmitEdit)==null?void 0:u.call(t))?(t.editable=!1,!0):!1:(!r&&!f&&((s=t.onCancelEdit)==null||s.call(t)),!0)}),K(mo,{value:a,record:t,column:e,index:n})}}function ho(e){const t=L(c(e).columns);let n=c(e).columns;const o=F(()=>{const d=ae(c(t));return s(e,d),d||[]}),{hasPermission:a}=We();function r(d){const g=d.ifShow;let v=!0;return V(g)&&(v=g),J(g)&&(v=g(d)),v}const f=(d,g)=>K(Ue,null,{trigger:()=>d,default:()=>g}),u=F(()=>{const d=c(o);return ae(d).filter(v=>a(v.auth)&&r(v)).map(v=>{v.ellipsis=typeof v.ellipsis=="undefined"?{tooltip:!0}:!1;const{edit:m}=v;if(m&&(v.render=go(v),m)){const h=v.title;v.title=()=>f(K("span",{},[K("span",{style:{"margin-right":"5px"}},h),K(we,{size:14},{default:()=>K(Ge)})]),"\u8BE5\u5217\u53EF\u7F16\u8F91")}return v})});me(()=>c(e).columns,d=>{t.value=d,n=d});function s(d,g){const{actionColumn:v}=c(d);!v||!g.find(m=>m.key==="action")&&g.push(w({},v))}function i(d){const g=ae(d);if(!te(g))return;if(!g.length){t.value=[];return}const v=n.map(m=>m.key);if(!Ce(g[0]))t.value=g;else{const m=[];n.forEach(h=>{d.includes(h.key)&&m.push(w({},h))}),an(v,g)||m.sort((h,k)=>v.indexOf(h.key)-v.indexOf(k.key)),t.value=m}}function y(){return X(c(o)).map(g=>I(w({},g),{title:g.title,key:g.key,fixed:g.fixed||void 0}))}function T(d){return d?n.map(g=>g.key):n}function R(d,g){!d||!g||n.forEach(v=>{if(v.key===d){Object.assign(v,g);return}})}return{getColumnsRef:o,getCacheColumns:T,setCacheColumnsField:R,setColumns:i,getColumns:y,getPageColumns:u}}const{table:po}=Gt,{apiSetting:vo,defaultPageSize:Co,pageSizes:_o}=po,wo=Co,oe=vo,yo=_o;function ko(e,{getPaginationInfo:t,setPagination:n,setLoading:o,tableData:a},r){const f=L([]);fe(()=>{a.value=c(f)}),me(()=>c(e).dataSource,()=>{const{dataSource:d}=c(e);d&&(f.value=d)},{immediate:!0});const u=F(()=>{const{rowKey:d}=c(e);return d||(()=>"key")}),s=F(()=>{const d=c(f);return!d||d.length===0?c(f):c(f)});function i(d){return B(this,null,function*(){try{o(!0);const{request:g,pagination:v,beforeRequest:m,afterRequest:h}=c(e);if(!g)return;const k=oe.pageField,C=oe.sizeField,$=oe.totalField,H=oe.listField,j=oe.countField;let M={};const{page:ee=1,pageSize:Y=10}=c(t);V(v)&&!v||V(t)?M={}:(M[k]=d&&d[k]||ee,M[C]=Y);let l=w(w({},M),d);m&&J(m)&&(l=(yield m(l))||l);const p=yield g(l),_=p[$],O=p[k],b=p[j],z=p[H]?p[H]:[];if(_){const E=Math.ceil(b/Y);if(ee>E)return n({page:E,itemCount:b}),yield i(d)}let N=p[H]?p[H]:[];h&&J(h)&&(N=(yield h(N))||N),f.value=N,n({page:O,pageCount:_,itemCount:b}),d&&d[k]&&n({page:d[k]||1}),r("fetch-success",{items:c(N),resultTotal:_})}catch(g){console.error(g),r("fetch-error",g),f.value=[],n({pageCount:0})}finally{o(!1)}})}Ye(()=>{setTimeout(()=>{i()},16)});function y(d){f.value=d}function T(){return s.value}function R(d){return B(this,null,function*(){yield i(d)})}return{fetch:i,getRowKey:u,getDataSourceRef:s,getDataSource:T,setTableData:y,reload:R}}function bo(e){const t=L({}),n=L(!0);me(()=>c(e).pagination,s=>{!V(s)&&s&&(t.value=w(w({},c(t)),s!=null?s:{}))});const o=F(()=>{const{pagination:s}=c(e);return!c(n)||V(s)&&!s?!1:w(w({page:1,pageSize:wo,pageSizes:yo,showSizePicker:!0,showQuickJumper:!0,prefix:i=>`\u5171 ${i.itemCount} \u6761`},V(s)?{}:s),c(t))});function a(s){const i=c(o);t.value=w(w({},V(i)?{}:i),s)}function r(){return c(o)}function f(){return c(n)}function u(s){return B(this,null,function*(){n.value=s})}return{getPagination:r,getPaginationInfo:o,setShowPagination:u,getShowPagination:f,setPagination:a}}const So=I(w({},Bt.props),{title:{type:String,default:null},titleTooltip:{type:String,default:null},size:{type:String,default:"medium"},dataSource:{type:[Object],default:()=>[]},columns:{type:[Array],default:()=>[],required:!0},beforeRequest:{type:Function,default:null},request:{type:Function,default:null},afterRequest:{type:Function,default:null},rowKey:{type:[String,Function],default:void 0},pagination:{type:[Object,Boolean],default:()=>{}},showPagination:{type:[String,Boolean],default:"auto"},actionColumn:{type:Object,default:null},canResize:_e.bool.def(!0),resizeHeightOffset:_e.number.def(0)});function Do(e,t=150,n){let o=()=>{e()};o=Zt(o,t);const r=()=>{n&&n.immediate&&o(),window.addEventListener("resize",o)},f=()=>{window.removeEventListener("resize",o)};return jt(()=>{r()}),Qt(()=>{f()}),[r,f]}const No=[{type:"menu",label:"\u7D27\u51D1",key:"small"},{type:"menu",label:"\u9ED8\u8BA4",key:"medium"},{type:"menu",label:"\u5BBD\u677E",key:"large"}],Ao=G({components:{ReloadOutlined:Yt,ColumnHeightOutlined:En,ColumnSetting:eo,QuestionCircleOutlined:qt},props:w({},So),emits:["fetch-success","fetch-error","update:checked-row-keys","edit-end","edit-cancel","edit-row-end","edit-change"],setup(e,{emit:t}){const n=L(150),o=L(null),a=L(null);let r;const f=L(!0),u=L([]),s=L(),i=F(()=>w(w({},e),c(s))),{getLoading:y,setLoading:T}=to(i),{getPaginationInfo:R,setPagination:d}=bo(i),{getDataSourceRef:g,getDataSource:v,getRowKey:m,reload:h}=ko(i,{getPaginationInfo:R,setPagination:d,tableData:u,setLoading:T},t),{getPageColumns:k,setColumns:C,getColumns:$,getCacheColumns:H,setCacheColumnsField:j}=ho(i),M=Ve({tableSize:c(i).size||"medium",isColumnSetting:!1});function ee(S){d({page:S}),h()}function Y(S){d({page:1,pageSize:S}),h()}function l(S){M.tableSize=S}const p=F(()=>M.tableSize),_=F(()=>{const S=c(g),U=S.length?`${c(n)}px`:"auto";return I(w({},c(i)),{loading:c(y),columns:X(c(k)),rowKey:c(m),data:S,size:c(p),remote:!0,"max-height":U})}),O=F(()=>X(c(R)));function b(S){s.value=w(w({},c(s)),S)}const z=S=>f.value=S,N={reload:h,setColumns:C,setLoading:T,setProps:b,getColumns:$,getPageColumns:k,getCacheColumns:H,setCacheColumnsField:j,emit:t},E=F(()=>{const{canResize:S}=c(i);return S});function P(){return B(this,null,function*(){const S=c(o);if(!S||!c(E))return;const U=S==null?void 0:S.$el,se=U.querySelector(".n-data-table-thead "),{bottomIncludeBody:ie}=ao(se),ge=64;let he=2,et=24;if(!V(c(O)))if(r=U.querySelector(".n-data-table__pagination"),r){const tt=r.offsetHeight;he+=tt||0}else he+=28;let le=ie-(ge+he+et+(e.resizeHeightOffset||0));const pe=e.maxHeight;le=pe&&pe<le?pe:le,n.value=le})}return Do(P,280),Ye(()=>{Ke(()=>{P()})}),qn(I(w({},N),{wrapRef:a,getBindValues:_})),I(w({},Ie(M)),{tableElRef:o,getBindValues:_,getDataSource:v,densityOptions:No,reload:h,densitySelect:l,updatePage:ee,updatePageSize:Y,pagination:O,tableAction:N,setStriped:z,isStriped:f})}});const Vo=G({name:"TableAction",components:{DownOutlined:Jt},props:{actions:{type:Array,default:null,required:!0},dropDownActions:{type:Array,default:null},style:{type:String,default:"button"},select:{type:Function,default:()=>{}}},setup(e){const{hasPermission:t}=We(),n=e.style==="button"?"default":e.style==="text"?"primary":"default",o=e.style==="button"?void 0:e.style==="text"?!0:void 0,a=F(()=>({text:o,type:n,size:"small"})),r=F(()=>(X(e.dropDownActions)||[]).filter(s=>t(s.auth)&&f(s)).map(s=>{const{popConfirm:i}=s;return I(w(w({size:"small",text:o,type:n},s),i),{onConfirm:i==null?void 0:i.confirm,onCancel:i==null?void 0:i.cancel})}));function f(s){const i=s.ifShow;let y=!0;return V(i)&&(y=i),J(i)&&(y=i(s)),y}return{getActions:F(()=>(X(e.actions)||[]).filter(s=>t(s.auth)&&f(s)).map(s=>{const{popConfirm:i}=s;return I(w(w({size:"small",text:o,type:n},s),i||{}),{onConfirm:i==null?void 0:i.confirm,onCancel:i==null?void 0:i.cancel,enable:!!i})})),getDropdownList:r,getMoreProps:a}}});export{Ao as _,eo as a,Vo as b};
